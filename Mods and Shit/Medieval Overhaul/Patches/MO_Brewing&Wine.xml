<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/RecipeDef[defName="Make_Wort"]</xpath>
        <value>
            <researchPrerequisites>
                <li>Brewing</li>
            </researchPrerequisites>
        </value>
    </Operation>
  <!-- Vanilla Brewing Expanded -->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Vanilla Brewing Expanded</li>
    </mods>
    <match Class="PatchOperationSequence">
      <operations>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DankPyon_Mead" or defName="DankPyon_Wine"]</xpath>
          <value>
            <thingCategories>
              <li>VBE_DrinksSimpleSpirits</li>
            </thingCategories>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="DankPyon_JuiceApple"]/thingCategories</xpath>
          <value>
            <thingCategories>
              <li>VBE_DrinksNonAlcoholic</li>
            </thingCategories>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="DankPyon_JuiceAppleUnfermented"]/thingCategories</xpath>
          <value>
            <thingCategories>
              <li>VBE_Musts</li>
            </thingCategories>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="DankPyon_JuiceAppleUnfermented"]/thingCategories</xpath>
          <value>
            <thingCategories>
              <li>VBE_Musts</li>
            </thingCategories>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Vanilla Factions Expanded - Medieval 2</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="DankPyon_Plant_Grape"]/plant/sowResearchPrerequisites</xpath>
          <value>
            <sowResearchPrerequisites>
              <li>VFEM2_Wine</li>
            </sowResearchPrerequisites>
          </value>
        </li> -->
                <li Class="PatchOperationReplace">
                    <xpath>Defs/RecipeDef[defName="DankPyon_MakeMustWine"]/researchPrerequisites</xpath>
                    <value>
                        <researchPrerequisites>
                            <li>VFEM2_Wine</li>
                        </researchPrerequisites>
                    </value>
                </li>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/RecipeDef[defName="DankPyon_MakeMustMulberry"]/researchPrerequisites</xpath>
                    <value>
                        <researchPrerequisites>
                            <li>VFEM2_Wine</li>
                        </researchPrerequisites>
                    </value>
                </li>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/RecipeDef[defName="DankPyon_MakeMustGriffon"]/researchPrerequisites</xpath>
                    <value>
                        <researchPrerequisites>
                            <li>VFEM2_Wine</li>
                        </researchPrerequisites>
                    </value>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="DankPyon_Wine"]/researchPrerequisites</xpath>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="DankPyon_Ale"]/researchPrerequisites</xpath>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="DankPyon_Mead"]/researchPrerequisites</xpath>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="DankPyon_Cider"]/researchPrerequisites</xpath>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ResearchProjectDef[defName="VFEM2_Wine"]</xpath>
                    <value>
                        <prerequisites>
                            <li>Brewing</li>
                        </prerequisites>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <ReplaceLib.ReplacerDef>
                            <defName>Ferny_MedievalOverhaul_VFEM2_ProgKitchen</defName>
                            <replacers>
                                <li>
                                    <replace>VFEM2_Plant_Grape</replace>
                                    <with>DankPyon_Plant_Grape</with>
                                </li>
                                <li>
                                    <replace>VFEM2_Must</replace>
                                    <with>DankPyon_MustWine</with>
                                </li>
                                <li>
                                    <replace>VFEM2_Wine</replace>
                                    <with>DankPyon_Wine</with>
                                </li>
                                <li>
                                    <replace>VFEM2_RawGrapes</replace>
                                    <with>DankPyon_RawGrapes</with>
                                </li>
                                <li>
                                    <replace>VFEM2_MeadFermentingBarrel</replace>
                                    <with>BarrelProcessor</with>
                                </li>
                                <li>
                                    <replace>VFEM2_VFEM2_WineBarrel</replace>
                                    <with>BarrelProcessor</with>
                                </li>
                                <li>
                                    <replace>VFEM2_Mead</replace>
                                    <with>DankPyon_Mead</with>
                                </li>
                            </replacers>
                        </ReplaceLib.ReplacerDef>
                    </value>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="BarrelProcessor"]/comps/li[@Class="ProcessorFramework.CompProperties_Processor"]/processes/li[.="VFEM2_Mead"]</xpath>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="BarrelProcessor"]/comps/li[@Class="ProcessorFramework.CompProperties_Processor"]/processes/li[.="VFEM2_Wine"]</xpath>
                </li>
                <!-- Processor Framework removes designation categories to make these unbuildable but they still show up in research -->
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="FermentingBarrel"]/researchPrerequisites</xpath>
                </li>
                <li Class="PatchOperationRemove">
                    <xpath>Defs/ThingDef[defName="VFEM2_WineBarrel"]/researchPrerequisites</xpath>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>